<html>
<head>
<script charset="utf-8" src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
<link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700' rel='stylesheet' type='text/css'>
<style>
body { font-family: 'Open Sans Condensed', 'sans-serif'; }
svg { border: solid black 1px; }

button { padding: 15px; margin: 10px;
	font-family: 'Open Sans Condensed', 'sans-serif';
	font-weight:700;
	width: 120;
	color: white;
	background-color: #ff4d4d;
	text-transform: uppercase;
	letter-spacing: 2px;
	padding: 10px 30px;
	border-radius: 5px;
	font-size: 16px;
	border: solid red 1px;}
		.axis path { fill: none; stroke: #aaa;}
	.axis line { stroke: #aaa; }
	.axis text { fill: #aaa; font-size: .7em; }
rect.bar { fill: #cc0000;; }
text.label {
	fill: #888;
	font-size: x-small;
	dominant-baseline: middle; 
	text-anchor: middle;

}
text.stateHeader{
	padding: 15px; margin: 10px;
	font-family: 'Open Sans Condensed', 'sans-serif';
	font-weight:700;
	color: red;
	font-size: 40px;
	letter-spacing: 2px;
	text-transform: uppercase;
	text-align: center;
}
</style>
</head>

<body>
	<h1>Online Dating</h1>
	<p>Instructions: Select either 'Teens' or 'Adults' to learn about statistics involving the selected group and online dating habits </p>
<div style="display: inline-block; vertical-align:center; float:left; padding: 30px">
	<div><button style="display: inline-block; " id="reset">Reset</button></div>
	<div><button style="display: inline-block;" id="income">Income</button></div>
	<div>
	<button style="display: inline-block; text-align:center" id="education" class="tButton tSelect">Education</button></div>
	<div><button style="display: inline-block;" id= "adults" class= "aButton aSelect">Children</button></div>
</div>
<div id="map" style="display: inline-block;"></div>
<div id = "panel" style="display: inline-block;"></div>

<script>
	//state data
	//all hidden 
	var currStatePanel="#Alaska";

	var svgMap = d3.select("#map").append("svg").attr("width",  700).attr("height", 500);
	var svgPanel = d3.select("#panel").append("svg").attr("width",  0).attr("height", 500).style("visibility","visible").style("float", "left");

	var projection = d3.geo.albersUsa().scale(860).translate([370, 250]);
	var stateNames = ['', "Alabama", "Alaska", '', 'Arizona', 'Arkansas', 'California', '', 'Colorado ', 'Connecticut ', 'Delaware ', 'District of Columbia', 'Florida', 'Georgia ', '', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 
	'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', '',  'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont ', 'Virginia ', '', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming'];

	for(var i=0; i< stateNames.length; i++){
		if (stateNames[i] != ""){
			var id = stateNames[i].replace(" ", "");
			var svg = d3.select("#panel").append("svg").attr("width",  300).attr("height", 500).style("visibility","hidden").style("position", "absolute").attr("id", id);
			svg.append("text").text(stateNames[i]).attr("x", 50).attr("y", 50).attr("class", "stateHeader");
			svg.append("svg").attr("width", 50).attr("height", 50);
			svg.append("text").text(id).attr("x", 50).attr("y", 450);
		}
	}

	d3.select("#Alaska").style("visibility", "visible");
	var path = d3.geo.path().projection(projection);

	d3.json("us.json", function(error, shapes) {
		states = topojson.feature(shapes, shapes.objects.states).features;
		console.log(states[0].id);
		var statePaths = svgMap.append("g");
		statePaths.selectAll("path").data(states).enter()
		.append("path").attr("d", path)
		.style("fill", "red").style("stroke", "#ccc")
		.on('click', function(d, i) {
			d3.select(currStatePanel).style("visibility", "hidden");
			var stateName = stateNames[states[i].id];
           	var id = "#" + stateName.replace(" ", "");
           	currStatePanel=id;

           	var svg = d3.select(id).style("visibility", "visible");
        })
		.on('mouseover', function(d, i) {
                var currentState = this;
                d3.select(this).style('fill-opacity', 1);
                })
		.on('mouseout', function(d, i) {
            d3.selectAll('path').style({'fill-opacity':.7});
        });
		
	});

</script>
<script>
var teens = {};
var teenSites = [];
var numTeenBreakups = { onlineGood: 0, onlineBad: 0, notOnlineGood: 0, notOnlineBad: 0 };  
var teenBreakups = [];
var adults;

// Splits the string into capitalized sites
var sanitizeSites = function (s) {
	if (s) {
		// Filter out invalid responses and correct misspelled ones
		var invalids = ["non of ya dam biz", "I forget the name", ",,,,,,", "1", "0", "na"];
		invalids.forEach( function (invalid) {
			if (s.indexOf(invalid) > -1) s = " ";
		});
		if (s.indexOf("FB") > -1 || s.indexOf("facebiij") > -1) s = "Facebook";
		if (s == "Gram") s = "Instagram";

		// Split
		var sites = s == " " ? [] : s.toUpperCase().replace("AND", ",").split(",");
		sites = sites.map( function (site) {
			return site.replace("WWW.", "").replace(".COM", "").trim();
		});
	
		return sites;
	} else {
		return [];
	}
	
};

// Load the data for online dating for teens
d3.csv("teen_dating.csv", function(error, teenIds) {
	// Store all necessary, sanitized data for the teens
	teenIds.forEach(function (teen) {
		teens[teen.CaseID] = {
			useOnlineDating: null,
			site: sanitizeSites(teen.REL3),
			acceptableBreakup: {
				text: teen.KR10_1,
				inPerson: teen.KR10_2,
				onlineMessage: teen.KR10_4,
				statusChange: teen.KR10_6
			},
			yourBreakupMethod: {
				inPerson: teen.KR11_B == 1,
				textEmailOnline: teen.KR11_C == 1 || teen.KR11_D == 1 || teen.KR11_E == 1,
				statusChange: teen.KR11_F == 1,
				postStatus: teen.KR11_G == 1,
				postImage: teen.KR11_H == 1
			},
			theirBreakupMethod: {
				inPerson: teen.KR12_B == 1,
				textEmailOnline: teen.KR12_C == 1 || teen.KR12_D == 1 || teen.KR12_E == 1,
				statusChange: teen.KR12_F == 1,
				postStatus: teen.KR12_G == 1,
				postImage: teen.KR12_H == 1
			},
			unsocialEx: teen.KRSNS4_A == 1 || teen.KRSNS4_C == 1
		};
		if (teen.KR1 == 2 || teen.KR1 == 3 || teen.KR1 == 4) {
			teens[teen.CaseID].useOnlineDating = true;
		} else {
			teens[teen.CaseID].useOnlineDating = false;
		}
	});

	// Extract all sanitized sites for teens who use online dating
	for (var teenId in teens) {
		var t = teens[teenId];
		if (t.useOnlineDating) {
			teenSites.push(t.site);

			var method = t.yourBreakupMethod;
			if (method.textEmailOnline) { teenBreakups["onlineBad"] += 1 }
			// teenBreakups["onlineGood"]
		}
		
	}
});

// Load the data for online dating for adults
d3.csv("adult_dating.csv", function (error, data){
	adults=data.filter(function (d){
		return{
			blocked: d.snsdate2a,
			untagged: d.snsdate2c,
			breakup: d.breaka,
			brokenup: d.breakb,
			usedDatingSite: d.date1a,
			match: d.date1bm1,
			eharmony:d.date1bm2,
			okcupid: d.date1bm3,
			plentyOfFish: d.date1bm4,
			christianMingle: d.date1bm5,
			true: d.date1bm6,
			zoosk:d.date1bm7,
			jdate:d.date1bm8,
			dateHookup:d.date1bm9,
			ashleyMadison:d.date1bm10,
			facebook:d.date1bm11,
			twitter:d.date1bm12,
			adultFriendFinder:d.date1bm13,
			blackplanet:d.date1bm14,
			chemistry:d.date1bm15,
			craigslist:d.date1bm16,
			other:d.date1bm17,
			goneOnDate:d.date5a,
			longTermRelationship:d.date5b,
			beenContacted:d.date5c,
			misrepresentedThemselves:d.date5d,
			helpCreateProfile:d.date5e,
			alreadyKnewMatch:d.date5f,
			goodWayToMeet:d.date9a,
			findBetterMatch:d.date9b,
			desperate:d.date9c,
			alwaysHaveNewOptions:d.date9d
		};
	});
});



</script>
</body>

</html>